
						--Challenge 1 - Steve's Car Showroom--
/*

Intro

Steve runs a top-end car showroom but his data analyst has just quit and left him without his crucial insights.
Can you analyse the following data to provide him with all the answers he requires?

*/

/*

Questions


1. What are the details of all cars purchased in the year 2022?
2. What is the total number of cars sold by each salesperson?
3. What is the total revenue generated by each salesperson?
4. What are the details of the cars sold by each salesperson?
5. What is the total revenue generated by each car type?
6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?
7. What is the total revenue generated by the sales of hatchback cars?
8. What is the total revenue generated by the sales of SUV cars in the year 2022?
9. What is the name and city of the salesperson who sold the most number of cars in the year 2023?
10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?

*/


CREATE DATABASE case_study
USE case_study


CREATE TABLE cars (
car_id INT PRIMARY KEY,
make VARCHAR(50),
type VARCHAR(50),
style VARCHAR(50),
cost_$ INT
);


INSERT INTO cars (car_id, make, type, style, cost_$) VALUES (1, 'Honda', 'Civic', 'Sedan', 30000),
															(2, 'Toyota', 'Corolla', 'Hatchback', 25000),
															(3, 'Ford', 'Explorer', 'SUV', 40000),
															(4, 'Chevrolet', 'Camaro', 'Coupe', 36000),
															(5, 'BMW', 'X5', 'SUV', 55000),
															(6, 'Audi', 'A4', 'Sedan', 48000),
															(7, 'Mercedes', 'C-Class', 'Coupe', 60000),
															(8, 'Nissan', 'Altima', 'Sedan', 26000);


---------------------------------------------------------------------------------------------------------------------------

CREATE TABLE salespersons (
salesman_id INT PRIMARY KEY,
name VARCHAR(50),
age INT,
city VARCHAR(50)
);


INSERT INTO salespersons (salesman_id, name, age, city) VALUES (1, 'John Smith', 28, 'New York'),
																(2, 'Emily Wong', 35, 'San Fran'),
																(3, 'Tom Lee', 42, 'Seattle'),
																(4, 'Lucy Chen', 31, 'LA');

------------------------------------------------------------------------------------------------------------

CREATE TABLE sales (
sale_id INT PRIMARY KEY,
car_id INT,
salesman_id INT,
purchase_date DATE,
FOREIGN KEY (car_id) REFERENCES cars(car_id),
FOREIGN KEY (salesman_id) REFERENCES salespersons(salesman_id)
);


INSERT INTO sales (sale_id, car_id, salesman_id, purchase_date) VALUES (1, 1, 1, '2021-01-01'),
																		(2, 3, 3, '2021-02-03'),
																		(3, 2, 2, '2021-02-10'),
																		(4, 5, 4, '2021-03-01'),
																		(5, 8, 1, '2021-04-02'),
																		(6, 2, 1, '2021-05-05'),
																		(7, 4, 2, '2021-06-07'),
																		(8, 5, 3, '2021-07-09'),
																		(9, 2, 4, '2022-01-01'),
																		(10, 1, 3, '2022-02-03'),
																		(11, 8, 2, '2022-02-10'),
																		(12, 7, 2, '2022-03-01'),
																		(13, 5, 3, '2022-04-02'),
																		(14, 3, 1, '2022-05-05'),
																		(15, 5, 4, '2022-06-07'),
																		(16, 1, 2, '2022-07-09'),
																		(17, 2, 3, '2023-01-01'),
																		(18, 6, 3, '2023-02-03'),
																		(19, 7, 1, '2023-02-10'),
																		(20, 4, 4, '2023-03-01');

-----------------------------------------------------------------------------------------

SELECT * FROM cars
SELECT * FROM sales
SELECT * FROM salespersons


/*
1. What are the details of all cars purchased in the year 2022?
*/

SELECT 
	s.purchase_date,
	c.car_id,
	c.make,
	c.type,
	c.cost_$
FROM sales s JOIN cars c
ON s.car_id = c.car_id 
WHERE YEAR(s.purchase_date) = 2022


/*
2. What is the total number of cars sold by each salesperson?
*/

	SELECT
		a.name as salseman,
		COUNT(s.sale_id) as total_car_sold
	FROM salespersons a JOIN sales s
	ON a.salesman_id = s.salesman_id
	GROUP BY a.name

/*
3. What is the total revenue generated by each salesperson?
*/

	SELECT
		s.name as Salesman,
		sum(cost_$) as total_revenue
	FROM salespersons s 
	JOIN sales  a
	ON   s.salesman_id = a.salesman_id
	JOIN cars c
	ON    a.car_id = c.car_id
	GROUP BY s.name

/*
4. What are the details of the cars sold by each salesperson?
*/

	SELECT
		s.name as Salesman,
		c.car_id,
		c.make as Company,
		c.type as Model,
		c.style as Style
	FROM salespersons s 
	JOIN sales a
	ON s.salesman_id = a.salesman_id
	JOIN cars c
	ON a.car_id = c.car_id


/*
5. What is the total revenue generated by each car type?
*/

	SELECT
		c.type as Model,
		sum(c.cost_$) as total_revenue
	FROM sales s
	JOIN cars c
	ON s.car_id = c.car_id
	GROUP BY c.type


/*
6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?
*/

	SELECT
		a.name as salsesman,
		c.make as company,
		c.type as model,
		c.style,
		c.cost_$
	FROM sales s JOIN salespersons a
	ON  s.salesman_id = a.salesman_id
	JOIN cars c 
	ON s.car_id = c.car_id
	WHERE a.name = 'Emily Wong'
	AND   YEAR(s.purchase_date) = 2021

	
/*
7. What is the total revenue generated by the sales of hatchback cars?
*/

	SELECT
		c.style as model,
		sum(c.cost_$) as total_revenue
	FROM sales s JOIN salespersons a
	ON   s.salesman_id = a.salesman_id
	JOIN cars c
	ON s.car_id = c.car_id
	WHERE c.style = 'Hatchback'
	GROUP BY c.style 


/*
8. What is the total revenue generated by the sales of SUV cars in the year 2022?
*/

	SELECT
		c.style,
		sum(c.cost_$) as total_revenue
	FROM sales s JOIN cars c
	ON   s.car_id = c.car_id
	WHERE c.style = 'SUV'
	AND   YEAR(s.purchase_date) = 2022
	GROUP BY c.style


/*
9. What is the name and city of the salesperson who sold the most number of cars in the year 2023?
*/

	SELECT 
		TOP 1
		a.name as Salesman,
		a.city,
		count(s.sale_id) as total_car_sale
	FROM sales s JOIN salespersons a
	ON   s.salesman_id = a.salesman_id
	WHERE YEAR(s.purchase_date) = 2023
	GROUP BY a.name, a.city
	ORDER BY total_car_sale DESC

/*
10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?
*/


	SELECT 
		TOP 1
		a.name as Salesman,
		a.age,
		sum(c.cost_$) as Total_Revenue
	FROM sales s JOIN salespersons a
	ON   s.salesman_id = a.salesman_id
	JOIN cars c
	ON   s.car_id = c.car_id
	WHERE YEAR(s.purchase_date) = 2022
	GROUP BY a.name, a.age
	ORDER BY Total_Revenue DESC

